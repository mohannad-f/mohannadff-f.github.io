<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>وصايا النبي - BASIRA IMAN</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- النقاط البيضاء المتحركة -->
    <div class="floating-dots" id="floatingDots"></div>

    <!-- تذكير الصلاة على النبي -->
    <div class="prayer-reminder">
        <div class="prayer-ar">صل على النبي محمد 💚</div>
        <div class="prayer-en">Peace and blessings be upon our Prophet Muhammad</div>
    </div>

    <!-- المحتوى الرئيسي -->
    <div class="container">
        <!-- رأس الصفحة -->
        <header class="page-header">
            <a href="index.html" class="back-btn" id="backBtn">
                <i class="fas fa-arrow-right"></i>
                <span id="backText">العودة للرئيسية</span>
            </a>
            <div class="page-title">
                <h1 class="title-ar" id="pageTitle">وصايا النبي</h1>
                <p class="title-en" id="pageSubtitle">Prophet's Teachings</p>
            </div>
        </header>

        <!-- شريط البحث -->
        <section class="search-section" id="searchSection">
            <div class="search-container">
                <input type="text" id="searchInput" class="search-input" placeholder="ابحث في الأحاديث...">
                <button class="search-btn" onclick="performSearch()">
                    <i class="fas fa-search"></i>
                </button>
            </div>
        </section>

        <!-- قائمة الأحاديث -->
        <div class="verses-list" id="hadithsList">
            <!-- سيتم ملؤها بواسطة JavaScript -->
        </div>

        <!-- محتوى الحديث -->
        <main class="verse-content" id="hadithContent" style="display: none;">
            <!-- نص الحديث -->
            <section class="verse-section">
                <div class="verse-header">
                    <h2>نص الحديث الشريف</h2>
                    <div class="verse-actions">
                        <button onclick="toggleFavorite()" class="action-btn favorite-btn" id="favoriteBtn">
                            <i class="fas fa-heart"></i>
                            <span id="favoriteBtnText">إضافة للمفضلة</span>
                        </button>
                    </div>
                </div>
                <div class="verse-text-container">
                    <p class="verse-text" id="hadithText"></p>
                </div>
            </section>

            <!-- التفسير -->
            <section class="interpretation-section">
                <div class="section-header">
                    <h2>التفسير والشرح</h2>
                    <div class="section-icon">
                        <i class="fas fa-book-open"></i>
                    </div>
                </div>
                <div class="interpretation-content" id="tafsirContent">
                </div>
            </section>

            <!-- الترجمة الإنجليزية -->
            <section class="english-section">
                <div class="section-header">
                    <h2>English Translation & Commentary</h2>
                    <div class="section-icon">
                        <i class="fas fa-globe"></i>
                    </div>
                </div>
                <div class="english-content" id="englishContent">
                </div>
            </section>
        </main>
    </div>

    <script>
        // إنشاء النقاط البيضاء المتحركة
        function createFloatingDots() {
            const container = document.getElementById('floatingDots');
            const dotCount = 30;
            
            for (let i = 0; i < dotCount; i++) {
                const dot = document.createElement('div');
                dot.className = 'dot';
                dot.style.left = Math.random() * 100 + '%';
                const duration = 10 + Math.random() * 10;
                dot.style.animationDuration = duration + 's';
                dot.style.animationDelay = Math.random() * 5 + 's';
                const size = 3 + Math.random() * 3;
                dot.style.width = size + 'px';
                dot.style.height = size + 'px';
                container.appendChild(dot);
            }
        }
        
        window.addEventListener('load', createFloatingDots);

        // تحميل البيانات
        let hadithsData = null;
        let currentHadithId = null;

        // تحميل البيانات من الملف
        fetch('hadith_data.json')
            .then(response => response.json())
            .then(data => {
                hadithsData = data.hadiths;
                showHadithsList();
                
                // التحقق من الرابط المباشر
                const hash = window.location.hash;
                if (hash.startsWith('#hadith_')) {
                    const hadithId = parseInt(hash.replace('#hadith_', ''));
                    showHadith(hadithId - 1);
                }
            })
            .catch(error => {
                console.error('خطأ في تحميل البيانات:', error);
            });

        // عرض قائمة الأحاديث
        function showHadithsList() {
            const hadithsList = document.getElementById('hadithsList');
            const hadithContent = document.getElementById('hadithContent');
            const searchSection = document.getElementById('searchSection');
            
            hadithsList.style.display = 'grid';
            hadithContent.style.display = 'none';
            searchSection.style.display = 'block';
            
            document.getElementById('pageTitle').textContent = 'وصايا النبي';
            document.getElementById('pageSubtitle').textContent = "Prophet's Teachings";
            document.getElementById('backBtn').href = 'index.html';
            document.getElementById('backText').textContent = 'العودة للرئيسية';
            
            hadithsList.innerHTML = hadithsData.map((hadith, index) => {
                return `
                    <a href="#" onclick="showHadith(${index}); return false;" class="verse-item">
                        <div class="verse-item-title">${escapeHtml(hadith.name)}</div>
                    </a>
                `;
            }).join('');
        }

        // عرض الحديث الكامل
        function showHadith(hadithIndex) {
            currentHadithId = hadithIndex;
            const hadith = hadithsData[hadithIndex];
            
            const hadithsList = document.getElementById('hadithsList');
            const hadithContent = document.getElementById('hadithContent');
            const searchSection = document.getElementById('searchSection');
            
            hadithsList.style.display = 'none';
            hadithContent.style.display = 'block';
            searchSection.style.display = 'none';
            
            document.getElementById('pageTitle').textContent = hadith.name;
            document.getElementById('pageSubtitle').textContent = "Hadith";
            document.getElementById('backBtn').href = '#';
            document.getElementById('backBtn').onclick = function() { showHadithsList(); return false; };
            document.getElementById('backText').textContent = 'العودة لقائمة الأحاديث';
            
            // نص الحديث
            document.getElementById('hadithText').textContent = hadith.hadith_text;
            
            // التفسير
            const tafsirParagraphs = hadith.tafsir_ar.split('\n\n').filter(p => p.trim());
            document.getElementById('tafsirContent').innerHTML = tafsirParagraphs.map(p => 
                `<p>${escapeHtml(p.trim())}</p>`
            ).join('');
            
            // الترجمة الإنجليزية
            const englishParts = hadith.english.split('\n\n').filter(p => p.trim());
            document.getElementById('englishContent').innerHTML = englishParts.map(part => {
                part = part.trim();
                if (part.startsWith('Narrated') || part.includes('(Sahih') || part.includes('[')) {
                    return `<p class="english-verse">${escapeHtml(part)}</p>`;
                } else {
                    return `<p>${escapeHtml(part)}</p>`;
                }
            }).join('');
            
            // تحديث زر المفضلة
            updateFavoriteButton();
            
            window.scrollTo(0, 0);
        }

        // البحث في الأحاديث
        function performSearch() {
            const searchTerm = document.getElementById('searchInput').value.trim().toLowerCase();
            
            if (!searchTerm) {
                showHadithsList();
                return;
            }
            
            const hadithsList = document.getElementById('hadithsList');
            const hadithContent = document.getElementById('hadithContent');
            
            hadithsList.style.display = 'grid';
            hadithContent.style.display = 'none';
            
            document.getElementById('pageTitle').textContent = 'نتائج البحث';
            document.getElementById('pageSubtitle').textContent = 'Search Results';
            document.getElementById('backBtn').href = '#';
            document.getElementById('backBtn').onclick = function() { showHadithsList(); return false; };
            document.getElementById('backText').textContent = 'العودة لقائمة الأحاديث';
            
            let results = [];
            
            hadithsData.forEach((hadith, index) => {
                if (hadith.name.toLowerCase().includes(searchTerm) ||
                    hadith.hadith_text.toLowerCase().includes(searchTerm) ||
                    hadith.tafsir_ar.toLowerCase().includes(searchTerm)) {
                    results.push({
                        index: index,
                        hadith: hadith
                    });
                }
            });
            
            if (results.length === 0) {
                hadithsList.innerHTML = '<div style="text-align: center; padding: 40px; color: #fff; font-size: 1.2rem;">لم يتم العثور على نتائج</div>';
            } else {
                hadithsList.innerHTML = results.map(result => {
                    return `
                        <a href="#" onclick="showHadith(${result.index}); return false;" class="verse-item">
                            <div class="verse-item-title">${escapeHtml(result.hadith.name)}</div>
                        </a>
                    `;
                }).join('');
            }
            
            window.scrollTo(0, 0);
        }

        // البحث عند الضغط على Enter
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        performSearch();
                    }
                });
            }
        });

        // إدارة المفضلة
        function toggleFavorite() {
            if (currentHadithId === null) return;
            
            const hadith = hadithsData[currentHadithId];
            
            let favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
            
            const favoriteId = `hadith_${hadith.id}`;
            const existingIndex = favorites.findIndex(f => f.id === favoriteId);
            
            if (existingIndex !== -1) {
                // إزالة من المفضلة
                favorites.splice(existingIndex, 1);
                showNotification('تم إزالة الحديث من المفضلة');
            } else {
                // إضافة للمفضلة
                favorites.push({
                    id: favoriteId,
                    type: 'hadith',
                    name: hadith.name,
                    text: hadith.hadith_text,
                    hadithId: hadith.id
                });
                showNotification('تمت إضافة الحديث للمفضلة');
            }
            
            localStorage.setItem('favorites', JSON.stringify(favorites));
            updateFavoriteButton();
        }

        function updateFavoriteButton() {
            if (currentHadithId === null) return;
            
            const hadith = hadithsData[currentHadithId];
            const favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
            const favoriteId = `hadith_${hadith.id}`;
            const isFavorite = favorites.some(f => f.id === favoriteId);
            
            const btn = document.getElementById('favoriteBtn');
            const btnText = document.getElementById('favoriteBtnText');
            
            if (isFavorite) {
                btn.classList.add('active');
                btnText.textContent = 'إزالة من المفضلة';
            } else {
                btn.classList.remove('active');
                btnText.textContent = 'إضافة للمفضلة';
            }
        }

        // تنظيف HTML
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // إظهار الإشعارات
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.classList.add('show');
            }, 100);

            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }
    </script>
</body>
</html>

